jQuery(document).ready((function(){ShortPixel.init()}));var ShortPixel=function(){function e(){if(typeof ShortPixel.API_IS_ACTIVE!=="undefined")return;if(jQuery("table.wp-list-table.media").length>0){jQuery('select[name^="action"] option:last-child').before('<option value="short-pixel-bulk">'+_spTr.optimizeWithSP+'</option><option value="short-pixel-bulk-lossy"> → '+_spTr.redoLossy+'</option><option value="short-pixel-bulk-glossy"> → '+_spTr.redoGlossy+'</option><option value="short-pixel-bulk-lossless"> → '+_spTr.redoLossless+'</option><option value="short-pixel-bulk-restore"> → '+_spTr.restoreOriginal+"</option>")}ShortPixel.setOptions(ShortPixelConstants[0]);if(jQuery("#backup-folder-size").length){jQuery("#backup-folder-size").html(ShortPixel.getBackupSize())}if(ShortPixel.MEDIA_ALERT=="todo"&&jQuery("div.media-frame.mode-grid").length>0){jQuery("div.media-frame.mode-grid").before('<div id="short-pixel-media-alert" class="notice notice-warning"><p>'+SPstringFormat(_spTr.changeMLToListMode,'<a href="upload.php?mode=list" class="view-list"><span class="screen-reader-text">'," </span>",'</a><a class="alignright" href="javascript:ShortPixel.dismissMediaAlert();">',"</a>")+"</p></div>")}jQuery(window).on("beforeunload",(function(){if(ShortPixel.bulkProcessor==true){clearBulkProcessor()}}));checkQuotaExceededAlert();checkBulkProgress()}function r(e){for(var r in e){ShortPixel[r]=e[r]}}function t(e){return/^\w+([\.+-]?\w+)*@\w+([\.-]?\w+)*(\.\w{1,63})+$/.test(e)}function i(){var e=jQuery("#pluginemail").val();if(ShortPixel.isEmailValid(e)){jQuery("#request_key").removeClass("disabled")}jQuery("#request_key").attr("href",jQuery("#request_key").attr("href").split("?")[0]+"?pluginemail="+e)}function s(e){jQuery("#valid").val("validate");jQuery(e).parents("form").submit()}jQuery("#key").keypress((function(e){if(e.which==13){jQuery("#valid").val("validate")}}));function o(e){if(jQuery(e).is(":checked")){jQuery("#width,#height").removeAttr("disabled");SpioResize.lastW=false;jQuery(".resize-type-wrap").show(800,window.SpioResize.run)}else{jQuery("#width,#height").attr("disabled","disabled");window.SpioResize.hide();jQuery(".resize-type-wrap").hide(800)}}function a(){if(!jQuery('input[name="removeExif"]').is(":checked")&&jQuery('input[name="png2jpg"]').is(":checked"))jQuery(".exif_warning").fadeIn();else jQuery(".exif_warning").fadeOut();if(!jQuery('input[name="removeExif"]').is(":checked")&&jQuery(".exif_imagick_warning").data("imagick")<=0)jQuery(".exif_imagick_warning").fadeIn();else jQuery(".exif_imagick_warning").fadeOut()}function l(){if(!jQuery('input[name="backupImages"]').is(":checked")){jQuery(".backup_warning").fadeIn()}else{jQuery(".backup_warning").fadeOut()}}function n(){var e=0;if(typeof document.wp_shortpixel_options!=="undefined")e=document.wp_shortpixel_options.compressionType;for(var r=0,t=null;r<e.length;r++){e[r].onclick=function(){if(this!==t){t=this}if(typeof ShortPixel.setupGeneralTabAlert!=="undefined")return;alert(_spTr.alertOnlyAppliesToNewImages);ShortPixel.setupGeneralTabAlert=1}}ShortPixel.enableResize("#resize");jQuery("#resize").change((function(){o(this)}));jQuery(".resize-sizes").blur((function(e){var r=jQuery(e.target);if(ShortPixel.resizeSizesAlert==r.val())return;ShortPixel.resizeSizesAlert=r.val();var t=jQuery("#min-"+r.attr("name")).val();var i=jQuery("#min-"+r.attr("name")).data("nicename");if(r.val()<Math.min(t,1024)){if(t>1024){alert(SPstringFormat(_spTr.pleaseDoNotSetLesser1024,i))}else{alert(SPstringFormat(_spTr.pleaseDoNotSetLesserSize,i,i,t))}e.preventDefault();r.focus()}else{this.defaultValue=r.val()}}));jQuery(".shortpixel-confirm").click((function(e){var r=confirm(e.target.getAttribute("data-confirm"));if(!r){e.preventDefault();return false}return true}));jQuery('input[name="removeExif"], input[name="png2jpg"]').on("change",(function(){ShortPixel.checkExifWarning()}));ShortPixel.checkExifWarning();jQuery('input[name="backupImages"]').on("change",(function(){ShortPixel.checkBackUpWarning()}));ShortPixel.checkBackUpWarning()}function u(){jQuery(".wp-shortpixel-options .shortpixel-key-valid").css("display","none");jQuery(".wp-shortpixel-options button#validate").css("display","inline-block")}function p(){jQuery("input.remove-folder-button").click((function(){var e=jQuery(this).data("value");var r=jQuery(this).data("name");var t=confirm(SPstringFormat(_spTr.areYouSureStopOptimizing,r));if(t==true){jQuery("#removeFolder").val(e);jQuery("#wp_shortpixel_options").submit()}}));jQuery("input.recheck-folder-button").click((function(){var e=jQuery(this).data("value");var r=confirm(SPstringFormat(_spTr.areYouSureStopOptimizing,e));if(r==true){jQuery("#recheckFolder").val(e);jQuery("#wp_shortpixel_options").submit()}}))}function c(e){var r=jQuery("#"+(e.checked?"total":"main")+"ToProcess").val();jQuery("div.bulk-play span.total").text(r);jQuery("#displayTotal").text(r)}function d(){ShortPixel.adjustSettingsTabs();ShortPixel.setupGeneralTab();jQuery(window).resize((function(){ShortPixel.adjustSettingsTabs()}));jQuery("article.sp-tabs a.tab-link").click((function(e){var r=jQuery(e.target).data("id");ShortPixel.switchSettingsTab(r)}));jQuery("input[type=radio][name=deliverWebpType]").change((function(){if(this.value=="deliverWebpAltered"){if(window.confirm(_spTr.alertDeliverWebPAltered)){var e=jQuery("input[type=radio][name=deliverWebpAlteringType]:checked").length;if(e==0){jQuery("#deliverWebpAlteredWP").prop("checked",true)}}else{jQuery(this).prop("checked",false)}}else if(this.value=="deliverWebpUnaltered"){window.alert(_spTr.alertDeliverWebPUnaltered)}}))}function h(e){var r=e.replace("tab-",""),t="",i=jQuery("section#"+e);jQuery('input[name="display_part"]').val(r);var s=window.location.href.toString();if(s.indexOf("?")>0){var o=s.substring(0,s.indexOf("?"));o+="?"+jQuery.param({page:"wp-shortpixel-settings",part:r});window.history.replaceState({},document.title,o)}if(i.length>0){jQuery("section").removeClass("sel-tab");jQuery("section .wp-shortpixel-tab-content").fadeOut(50);jQuery(i).addClass("sel-tab");ShortPixel.adjustSettingsTabs();jQuery(i).find(".wp-shortpixel-tab-content").fadeIn(50)}if(typeof HS!=="undefined"&&typeof HS.beacon.suggest!=="undefined"){switch(r){case"settings":t=shortpixel_suggestions_settings;break;case"adv-settings":t=shortpixel_suggestions_adv_settings;break;case"cloudflare":case"stats":t=shortpixel_suggestions_cloudflare;break;default:break}HS.beacon.suggest(t)}}function f(){var e=jQuery("section.sel-tab").height()+90;jQuery(".section-wrapper").css("height",e)}function m(){var e={action:"shortpixel_dismiss_media_alert"};jQuery.get(ShortPixel.AJAX_URL,e,(function(r){e=JSON.parse(r);if(e["Status"]=="success"){jQuery("#short-pixel-media-alert").hide()}}))}function g(){jQuery("#shortpixel-hs-button-blind").remove();jQuery("#shortpixel-hs-tools").remove();jQuery("#hs-beacon").remove();jQuery("#botbutton").remove();jQuery("#shortpixel-hs-blind").remove()}function S(){g();dismissShortPixelNotice("help")}function y(){var e={action:"shortpixel_check_quota",nonce:ShortPixelActions.nonce_check_quota,return_json:true};jQuery.post(ShortPixel.AJAX_URL,e,(function(e){console.log("quota refreshed");console.log(e);window.location.href=e.redirect}))}function x(e){if(e.checked){jQuery("#with-thumbs").css("display","inherit");jQuery("#without-thumbs").css("display","none")}else{jQuery("#without-thumbs").css("display","inherit");jQuery("#with-thumbs").css("display","none")}}function j(e,r,t,i,s){return(r>0?"<div class='sp-column-info'>"+_spTr.reducedBy+" <strong><span class='percent'>"+r+"%</span></strong> ":"")+(r>0&&r<5?"<br>":"")+(r<5?_spTr.bonusProcessing:"")+(t.length>0?" ("+t+")":"")+(0+i>0?"<br>"+SPstringFormat(_spTr.plusXthumbsOpt,i):"")+(0+s>0?"<br>"+SPstringFormat(_spTr.plusXretinasOpt,s):"")+"</div>"}function P(e,r){jQuery(e).knob({readOnly:true,width:r,height:r,fgColor:"#1CAECB",format:function(e){return e+"%"}})}function v(e,r,t,i,s,o){if(s==1){var a=jQuery(".sp-column-actions-template").clone();if(!a.length)return false;var l;if(r.length==0){l=["lossy","lossless"]}else{l=["lossy","glossy","lossless"].filter((function(e){return!(e==r)}))}a.html(a.html().replace(/__SP_ID__/g,e));if(o.substr(o.lastIndexOf(".")+1).toLowerCase()=="pdf"){jQuery(".sp-action-compare",a).remove()}if(t==0&&i>0){a.html(a.html().replace("__SP_THUMBS_TOTAL__",i))}else{jQuery(".sp-action-optimize-thumbs",a).remove();jQuery(".sp-dropbtn",a).removeClass("button-primary")}a.html(a.html().replace(/__SP_FIRST_TYPE__/g,l[0]));a.html(a.html().replace(/__SP_SECOND_TYPE__/g,l[1]));return a.html()}return""}function Q(e,r){e=e.substring(2);if(jQuery(".shortpixel-other-media").length){var t=["optimize","retry","restore","redo","quota","view"];for(var i=0,s=t.length;i<s;i++){jQuery("#"+t[i]+"_"+e).css("display","none")}for(var i=0,s=r.length;i<s;i++){jQuery("#"+r[i]+"_"+e).css("display","")}}}function b(e){ShortPixel.retries++;if(isNaN(ShortPixel.retries))ShortPixel.retries=1;if(ShortPixel.retries<6){console.log("Invalid response from server (Error: "+e+"). Retrying pass "+(ShortPixel.retries+1)+"...");setBulkTimer(5e3)}else{ShortPixel.bulkShowError(-1,"Invalid response from server received 6 times. Please retry later by reloading this page, or <a href='https://shortpixel.com/contact' target='_blank'>contact support</a>. (Error: "+e+")","");console.log("Invalid response from server 6 times. Giving up.")}}function k(e){e.action="shortpixel_browse_content";var r="";jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:e,success:function(e){r=e},async:false});return r}function T(){var e={action:"shortpixel_get_backup_size"};var r="";jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:e,success:function(e){r=e},async:false});return r}function _(e){if(!jQuery("#tos").is(":checked")){e.preventDefault();jQuery("#tos-robo").fadeIn(400,(function(){jQuery("#tos-hand").fadeIn()}));jQuery("#tos").click((function(){jQuery("#tos-robo").css("display","none");jQuery("#tos-hand").css("display","none")}));return}jQuery("#request_key").addClass("disabled");jQuery("#pluginemail_spinner").addClass("is-active");ShortPixel.updateSignupEmail();if(ShortPixel.isEmailValid(jQuery("#pluginemail").val())){jQuery("#pluginemail-error").css("display","none");var r={action:"shortpixel_new_api_key",email:jQuery("#pluginemail").val()};jQuery.ajax({type:"POST",async:false,url:ShortPixel.AJAX_URL,data:r,success:function(r){data=JSON.parse(r);if(data["Status"]=="success"){e.preventDefault();window.location.reload()}else if(data["Status"]=="invalid"){jQuery("#pluginemail-error").html("<b>"+data["Details"]+"</b>");jQuery("#pluginemail-error").css("display","");jQuery("#pluginemail-info").css("display","none");e.preventDefault()}else{}}});jQuery("#request_key").removeAttr("onclick")}else{jQuery("#pluginemail-error").css("display","");jQuery("#pluginemail-info").css("display","none");e.preventDefault()}jQuery("#request_key").removeClass("disabled");jQuery("#pluginemail_spinner").removeClass("is-active")}function w(){jQuery("#shortPixelProposeUpgrade .sp-modal-body").addClass("sptw-modal-spinner");jQuery("#shortPixelProposeUpgrade .sp-modal-body").html("");jQuery("#shortPixelProposeUpgradeShade").css("display","block");jQuery("#shortPixelProposeUpgrade").removeClass("shortpixel-hide");var e={action:"shortpixel_propose_upgrade"};jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:e,success:function(e){jQuery("#shortPixelProposeUpgrade .sp-modal-body").removeClass("sptw-modal-spinner");jQuery("#shortPixelProposeUpgrade .sp-modal-body").html(e)}})}function C(){jQuery("#shortPixelProposeUpgradeShade").css("display","none");jQuery("#shortPixelProposeUpgrade").addClass("shortpixel-hide");if(ShortPixel.toRefresh){ShortPixel.checkQuota()}}function A(){jQuery(".select-folder-button").click((function(){jQuery(".sp-folder-picker-shade").fadeIn(100);jQuery(".shortpixel-modal.modal-folder-picker").show();var e=jQuery(".sp-folder-picker");e.parent().css("margin-left",-e.width()/2);e.fileTree({script:ShortPixel.browseContent,multiFolder:false})}));jQuery(".shortpixel-modal input.select-folder-cancel, .sp-folder-picker-shade").click((function(){jQuery(".sp-folder-picker-shade").fadeOut(100);jQuery(".shortpixel-modal.modal-folder-picker").hide()}));jQuery(".shortpixel-modal input.select-folder").click((function(e){var r=jQuery("UL.jqueryFileTree LI.directory.selected");if(jQuery(r).length==0)var r=jQuery("UL.jqueryFileTree LI.selected").parents(".directory");var t=jQuery(r).children("a").attr("rel");if(typeof t==="undefined")return;t=t.trim();if(t){var i=jQuery("#customFolderBase").val()+t;i=i.replace(/\/\//,"/");console.debug("FullPath"+i);jQuery("#addCustomFolder").val(i);jQuery("#addCustomFolderView").val(i);jQuery(".sp-folder-picker-shade").fadeOut(100);jQuery(".shortpixel-modal.modal-folder-picker").css("display","none");jQuery("#saveAdvAddFolder").removeClass("hidden")}else{alert("Please select a folder from the list.")}}))}function U(e,r,t){var i=jQuery(".bulk-notice-msg.bulk-lengthy");if(i.length==0)return;var s=jQuery("a",i);s.text(r);if(t){s.attr("href",t)}else{s.attr("href",s.data("href").replace("__ID__",e))}i.css("display","block")}function z(){jQuery(".bulk-notice-msg.bulk-lengthy").css("display","none")}function R(e){var r=jQuery(".bulk-notice-msg.bulk-"+e);if(r.length==0)return;r.css("display","block")}function E(e){jQuery(".bulk-notice-msg.bulk-"+e).css("display","none")}function M(e,r,t,i){var s=jQuery("#bulk-error-template");if(s.length==0)return;var o=s.clone();o.attr("id","bulk-error-"+e);if(e==-1){jQuery("span.sp-err-title",o).remove();o.addClass("bulk-error-fatal")}else{jQuery("img",o).remove();jQuery("#bulk-error-".id).remove()}jQuery("span.sp-err-content",o).html(r);var a=jQuery("a.sp-post-link",o);if(i){a.attr("href",i)}else{a.attr("href",a.attr("href").replace("__ID__",e))}a.text(t);s.after(o);o.css("display","block")}function B(e,r){if(!confirm(_spTr["confirmBulk"+e])){r.stopPropagation();r.preventDefault();return false}return true}function L(e){var r=jQuery(e.target).val();var t=jQuery('input[name="random_answer"]').val();var i=jQuery('input[name="random_answer"]').data("target");if(r==t){jQuery(i).removeClass("disabled").prop("disabled",false);jQuery(i).removeAttr("aria-disabled")}else{jQuery(i).addClass("disabled").prop("disabled",true)}}function I(e){jQuery(e).parent().parent().remove()}function D(e){return e.substring(0,2)=="C-"}function O(e){e.preventDefault();if(!this.menuCloseEvent){jQuery(window).click((function(e){if(!e.target.matches(".sp-dropbtn")){jQuery(".sp-dropdown.sp-show").removeClass("sp-show")}}));this.menuCloseEvent=true}var r=e.target.parentElement.classList.contains("sp-show");jQuery(".sp-dropdown.sp-show").removeClass("sp-show");if(!r)e.target.parentElement.classList.add("sp-show")}function F(e){this.comparerData.origUrl=false;if(this.comparerData.cssLoaded===false){jQuery("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:this.WP_PLUGIN_URL+"/res/css/twentytwenty.min.css"});this.comparerData.cssLoaded=2}if(this.comparerData.jsLoaded===false){jQuery.getScript(this.WP_PLUGIN_URL+"/res/js/jquery.twentytwenty.min.js",(function(){ShortPixel.comparerData.jsLoaded=2;if(ShortPixel.comparerData.origUrl.length>0){ShortPixel.displayComparerPopup(ShortPixel.comparerData.width,ShortPixel.comparerData.height,ShortPixel.comparerData.origUrl,ShortPixel.comparerData.optUrl)}}));this.comparerData.jsLoaded=1}if(this.comparerData.origUrl===false){jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:{action:"shortpixel_get_comparer_data",id:e},success:function(e){data=JSON.parse(e);jQuery.extend(ShortPixel.comparerData,data);if(ShortPixel.comparerData.jsLoaded==2){ShortPixel.displayComparerPopup(ShortPixel.comparerData.width,ShortPixel.comparerData.height,ShortPixel.comparerData.origUrl,ShortPixel.comparerData.optUrl)}}});this.comparerData.origUrl=""}}function N(e,r,t,i){var s=e;var o=r<150||e<350;var a=jQuery(o?"#spUploadCompareSideBySide":"#spUploadCompare");var l=jQuery(".sp-modal-shade");if(!o){jQuery("#spCompareSlider").html('<img alt="'+_spTr.originalImage+'" class="spUploadCompareOriginal"/><img alt="'+_spTr.optimizedImage+'" class="spUploadCompareOptimized"/>')}e=Math.max(350,Math.min(800,e<350?(e+25)*2:r<150?e+25:e));r=Math.max(150,o?s>350?2*(r+45):r+45:r*e/s);var n="-"+Math.round(e/2);jQuery(".sp-modal-body",a).css("width",e);jQuery(".shortpixel-slider",a).css("width",e);a.css("width",e);a.css("marginLeft",n+"px");jQuery(".sp-modal-body",a).css("height",r);a.show();l.show();if(!o){jQuery("#spCompareSlider").twentytwenty({slider_move:"mousemove"})}jQuery(".sp-close-button").on("click",ShortPixel.closeComparerPopup);jQuery(document).on("keyup.sp_modal_active",ShortPixel.closeComparerPopup);jQuery(".sp-modal-shade").on("click",ShortPixel.closeComparerPopup);var u=jQuery(".spUploadCompareOptimized",a);jQuery(".spUploadCompareOriginal",a).attr("src",t);setTimeout((function(){jQuery(window).trigger("resize")}),1e3);u.load((function(){jQuery(window).trigger("resize")}));u.attr("src",i)}function W(e){jQuery("#spUploadCompareSideBySide").hide();jQuery("#spUploadCompare").hide();jQuery(".sp-modal-shade").hide();jQuery(document).unbind("keyup.sp_modal_active");jQuery(".sp-modal-shade").off("click");jQuery(".sp-close-button").off("click")}function J(e){var r=document.createElement("a");r.href=e;if(e.indexOf(r.protocol+"//"+r.hostname)<0){return r.href}return e.replace(r.protocol+"//"+r.hostname,r.protocol+"//"+r.hostname.split(".").map((function(e){return sp_punycode.toASCII(e)})).join("."))}return{init:e,setOptions:r,isEmailValid:t,updateSignupEmail:i,validateKey:s,enableResize:o,setupGeneralTab:n,apiKeyChanged:u,setupAdvancedTab:p,checkThumbsUpdTotal:c,initSettings:d,switchSettingsTab:h,adjustSettingsTabs:f,onBulkThumbsCheck:x,dismissMediaAlert:m,closeHelpPane:g,dismissHelpPane:S,checkQuota:y,percentDial:P,successMsg:j,successActions:v,otherMediaUpdateActions:Q,retry:b,initFolderSelector:A,browseContent:k,getBackupSize:T,newApiKey:_,proposeUpgrade:w,closeProposeUpgrade:C,bulkShowLengthyMsg:U,bulkHideLengthyMsg:z,bulkShowMaintenanceMsg:R,bulkHideMaintenanceMsg:E,bulkShowError:M,confirmBulkAction:B,checkRandomAnswer:L,removeBulkMsg:I,isCustomImageId:D,openImageMenu:O,menuCloseEvent:false,loadComparer:F,displayComparerPopup:N,closeComparerPopup:W,convertPunycode:J,checkExifWarning:a,checkBackUpWarning:l,comparerData:{cssLoaded:false,jsLoaded:false,origUrl:false,optUrl:false,width:0,height:0},toRefresh:false,resizeSizesAlert:false,returnedStatusSearching:0}}();function showToolBarAlert(e,r,t){var i=jQuery("li.shortpixel-toolbar-processing");switch(e){case ShortPixel.STATUS_QUOTA_EXCEEDED:if(window.location.href.search("wp-short-pixel-bulk")>0&&jQuery(".sp-quota-exceeded-alert").length==0){return}i.addClass("shortpixel-alert");i.addClass("shortpixel-quota-exceeded");jQuery("a",i).attr("href","options-general.php?page=wp-shortpixel-settings");jQuery("a div",i).attr("title","ShortPixel quota exceeded. Click for details.");break;case ShortPixel.STATUS_SKIP:case ShortPixel.STATUS_FAIL:i.addClass("shortpixel-alert shortpixel-processing");jQuery("a div",i).attr("title",r);if(typeof t!=="undefined"){jQuery("a",i).attr("href","post.php?post="+t+"&action=edit")}break;case ShortPixel.STATUS_NO_KEY:i.addClass("shortpixel-alert");i.addClass("shortpixel-quota-exceeded");jQuery("a",i).attr("href","options-general.php?page=wp-shortpixel-settings");jQuery("a div",i).attr("title","Get API Key");break;case ShortPixel.STATUS_SUCCESS:case ShortPixel.STATUS_RETRY:i.addClass("shortpixel-processing");i.removeClass("shortpixel-alert");jQuery("a",i).removeAttr("target");jQuery("a",i).attr("href",jQuery("a img",i).attr("success-url"))}i.removeClass("shortpixel-hide")}function hideToolBarAlert(e){var r=jQuery("li.shortpixel-toolbar-processing.shortpixel-processing");if(ShortPixel.STATUS_EMPTY_QUEUE==e){if(r.hasClass("shortpixel-alert")||r.hasClass("shortpixel-quota-exceeded")){return}}r.addClass("shortpixel-hide")}function hideQuotaExceededToolBarAlert(){jQuery("li.shortpixel-toolbar-processing.shortpixel-quota-exceeded").addClass("shortpixel-hide")}function checkQuotaExceededAlert(){if(typeof shortPixelQuotaExceeded!="undefined"){if(shortPixelQuotaExceeded==1){showToolBarAlert(ShortPixel.STATUS_QUOTA_EXCEEDED)}else{hideQuotaExceededToolBarAlert()}}}function checkBulkProgress(){var e=function(e){if(!r){r=true;return e}return"/"};var r=false;var t=window.location.href.toLowerCase().replace(/\/\//g,e);r=false;var i=ShortPixel.WP_ADMIN_URL.toLowerCase().replace(/\/\//g,e);if(t.search(i)<0){t=ShortPixel.convertPunycode(t);i=ShortPixel.convertPunycode(i)}if(ShortPixel.bulkProcessor==true&&window.location.href.search("wp-short-pixel-bulk")<0&&typeof localStorage.bulkPage!=="undefined"&&localStorage.bulkPage>0){ShortPixel.bulkProcessor=false}if(window.location.href.search("wp-short-pixel-bulk")>=0){ShortPixel.bulkProcessor=true;localStorage.bulkTime=Date.now();localStorage.bulkPage=1;ShortPixel.BULK_SECRET=false}if(ShortPixel.BULK_SECRET!==false){if(ShortPixel.BULK_SECRET!=localStorage.bulkSecret){clearBulkProcessor();jQuery("li.shortpixel-toolbar-processing").removeClass("shortpixel-processing");jQuery("li.shortpixel-toolbar-processing").addClass("shortpixel-hide");return}}if(ShortPixel.bulkProcessor==true||typeof localStorage.bulkTime=="undefined"||Date.now()-localStorage.bulkTime>1e4){ShortPixel.bulkProcessor=true;localStorage.bulkPage=window.location.href.search("wp-short-pixel-bulk")>=0?1:0;localStorage.bulkTime=Date.now();if(localStorage.getItem("bulkSecret")==null)localStorage.bulkSecret=Math.random().toString(36).substring(7);checkBulkProcessingCallApi()}else{setBulkTimer(2e4)}}var bulkTimer;function setBulkTimer(e){window.clearTimeout(bulkTimer);if(e>0){bulkTimer=window.setTimeout(checkBulkProgress,e)}}function checkBulkProcessingCallApi(){var e={action:"shortpixel_image_processing","bulk-secret":localStorage.bulkSecret};jQuery.ajax({type:"POST",url:ShortPixel.AJAX_URL,data:e,success:function(e){if(e.length>0){var r=null;try{var r=JSON.parse(e)}catch(e){ShortPixel.retry(e.message);return}ShortPixel.retries=0;var t=r["ImageID"];var i=jQuery("div.short-pixel-bulk-page").length>0;if(r["Status"]&&r["Status"]!=ShortPixel.STATUS_SEARCHING){if(ShortPixel.returnedStatusSearching>=2)jQuery(".bulk-notice-msg.bulk-searching").hide();ShortPixel.returnedStatusSearching=0}switch(r["Status"]){case ShortPixel.STATUS_NO_KEY:setCellMessage(t,r["Message"],"<a class='button button-smaller button-primary' href=\"https://shortpixel.com/wp-apikey"+'" target="_blank">'+_spTr.getApiKey+"</a>");showToolBarAlert(ShortPixel.STATUS_NO_KEY);break;case ShortPixel.STATUS_QUOTA_EXCEEDED:setCellMessage(t,r["Message"],"<a class='button button-smaller button-primary' href=\"https://shortpixel.com/login/"+'" target="_blank">'+_spTr.extendQuota+"</a>"+"<a class='button button-smaller' href='javascript:ShortPixel.checkQuota()'>"+_spTr.check__Quota+"</a>");showToolBarAlert(ShortPixel.STATUS_QUOTA_EXCEEDED);if(r["Stop"]==false){setBulkTimer(5e3)}ShortPixel.otherMediaUpdateActions(t,["quota","view"]);break;case ShortPixel.STATUS_FAIL:setCellMessage(t,r["Message"],"<a class='button button-smaller button-primary' href=\"javascript:manualOptimization('"+t+"', true)\">"+_spTr.retry+"</a>");showToolBarAlert(ShortPixel.STATUS_FAIL,r["Message"],t);if(i){ShortPixel.bulkShowError(t,r["Message"],r["Filename"],r["CustomImageLink"]);if(r["BulkPercent"]){progressUpdate(r["BulkPercent"],r["BulkMsg"])}ShortPixel.otherMediaUpdateActions(t,["retry","view"])}console.log(r["Message"]);setBulkTimer(5e3);break;case ShortPixel.STATUS_EMPTY_QUEUE:console.log(r["Message"]);clearBulkProcessor();hideToolBarAlert(r["Status"]);var s=jQuery("#bulk-progress");if(i&&s.length&&r["BulkStatus"]!="2"){progressUpdate(100,"Bulk finished!");jQuery("a.bulk-cancel").attr("disabled","disabled");hideSlider();setTimeout((function(){window.location.reload()}),3e3)}break;case ShortPixel.STATUS_SUCCESS:if(i){ShortPixel.bulkHideLengthyMsg();ShortPixel.bulkHideMaintenanceMsg()}var o=r["PercentImprovement"];showToolBarAlert(ShortPixel.STATUS_SUCCESS,"");var a=ShortPixel.isCustomImageId(t)?"":ShortPixel.successActions(t,r["Type"],r["ThumbsCount"],r["ThumbsTotal"],r["BackupEnabled"],r["Filename"]);setCellMessage(t,ShortPixel.successMsg(t,o,r["Type"],r["ThumbsCount"],r["RetinasCount"]),a);if(jQuery("#post-"+t).length>0)jQuery("#post-"+t).find(".filename").text(r["Filename"]);if(jQuery(".misc-pub-filename strong").length>0)jQuery(".misc-pub-filename strong").text(r["Filename"]);if(ShortPixel.isCustomImageId(t)&&r["TsOptimized"]&&r["TsOptimized"].length>0){var l=jQuery(".list-overview .item-"+t);jQuery(l).children(".date").text(r["TsOptimized"]);jQuery(l).find(".row-actions .action-optimize").remove()}var n=jQuery(["restore","view","redolossy","redoglossy","redolossless"]).not(["redo"+r["Type"]]).get();ShortPixel.otherMediaUpdateActions(t,n);var u=new PercentageAnimator("#sp-msg-"+t+" span.percent",o);u.animate(o);if(i&&typeof r["Thumb"]!=="undefined"){if(r["BulkPercent"]){progressUpdate(r["BulkPercent"],r["BulkMsg"])}if(r["Thumb"].length>0){sliderUpdate(t,r["Thumb"],r["BkThumb"],r["PercentImprovement"],r["Filename"]);if(typeof r["AverageCompression"]!=="undefined"&&0+r["AverageCompression"]>0){jQuery("#sp-avg-optimization").html('<input type="text" class="dial" value="'+Math.round(r["AverageCompression"])+'"/>');ShortPixel.percentDial("#sp-avg-optimization .dial",60)}}}console.log("Server response: "+e);if(i&&typeof r["BulkPercent"]!=="undefined"){progressUpdate(r["BulkPercent"],r["BulkMsg"])}setBulkTimer(5e3);break;case ShortPixel.STATUS_SKIP:if(r["Silent"]!==1){ShortPixel.bulkShowError(t,r["Message"],r["Filename"],r["CustomImageLink"])}case ShortPixel.STATUS_ERROR:if(typeof r["Message"]!=="undefined"){showToolBarAlert(ShortPixel.STATUS_SKIP,r["Message"]+" Image ID: "+t);setCellMessage(t,r["Message"],"")}ShortPixel.otherMediaUpdateActions(t,["retry","view"]);case ShortPixel.STATUS_RETRY:console.log("Server response: "+e);showToolBarAlert(ShortPixel.STATUS_RETRY,"");if(i&&typeof r["BulkPercent"]!=="undefined"){progressUpdate(r["BulkPercent"],r["BulkMsg"])}if(i&&r["Count"]>3){ShortPixel.bulkShowLengthyMsg(t,r["Filename"],r["CustomImageLink"])}setBulkTimer(5e3);break;case ShortPixel.STATUS_SEARCHING:console.log("Server response: "+e);ShortPixel.returnedStatusSearching++;if(ShortPixel.returnedStatusSearching>=2){jQuery(".bulk-notice-msg.bulk-searching").show()}setBulkTimer(2500);break;case ShortPixel.STATUS_MAINTENANCE:ShortPixel.bulkShowMaintenanceMsg("maintenance");setBulkTimer(6e4);break;case ShortPixel.STATUS_QUEUE_FULL:ShortPixel.bulkShowMaintenanceMsg("queue-full");setBulkTimer(6e4);break;default:ShortPixel.retry("Unknown status "+r["Status"]+". Retrying...");break}if(typeof t!="undefined"&&ShortPixel.isCustomImageId(t)){var l=jQuery(".list-overview .item-"+t);jQuery(l).find(".row-actions .action-optimize").remove();if(r["actions"]){jQuery(l).children(".actions").html(r["actions"])}}}},error:function(e){ShortPixel.retry(e.statusText)}})}function clearBulkProcessor(){ShortPixel.bulkProcessor=false;localStorage.bulkTime=Date.now();setBulkTimer(0);if(window.location.href.search("wp-short-pixel-bulk")>=0){localStorage.bulkPage=0}}function setCellMessage(e,r,t){var i=jQuery("#sp-msg-"+e);if(i.length>0){i.html("<div class='sp-column-actions'>"+t+"</div>"+"<div class='sp-column-info'>"+r+"</div>");i.css("color","")}i=jQuery("#sp-cust-msg-"+e);if(i.length>0){i.html("<div class='sp-column-info'>"+r+"</div>")}}function manualOptimization(e,r){setCellMessage(e,"<img src='"+ShortPixel.WP_PLUGIN_URL+"/res/img/loading.gif' alt='"+_spTr.loading+"' class='sp-loading-small'>Image waiting to be processed","");jQuery("li.shortpixel-toolbar-processing").removeClass("shortpixel-hide");jQuery("li.shortpixel-toolbar-processing").removeClass("shortpixel-alert");jQuery("li.shortpixel-toolbar-processing").addClass("shortpixel-processing");var t={action:"shortpixel_manual_optimization",image_id:e,cleanup:r};jQuery.ajax({type:"GET",url:ShortPixel.AJAX_URL,data:t,success:function(r){var t=JSON.parse(r);if(t["Status"]==ShortPixel.STATUS_SUCCESS){setBulkTimer(2e3);ShortPixel.BULK_SECRET=false}else{setCellMessage(e,typeof t["Message"]!=="undefined"?t["Message"]:_spTr.thisContentNotProcessable,"")}},error:function(r){t.action="shortpixel_check_status";jQuery.ajax({type:"GET",url:ShortPixel.AJAX_URL,data:t,success:function(r){var t=JSON.parse(r);if(t["Status"]!==ShortPixel.STATUS_SUCCESS){setCellMessage(e,typeof t["Message"]!=="undefined"?t["Message"]:_spTr.thisContentNotProcessable,"")}}})}})}function reoptimize(e,r){setCellMessage(e,"<img src='"+ShortPixel.WP_PLUGIN_URL+"/res/img/loading.gif' alt='"+_spTr.loading+"' class='sp-loading-small'>Image waiting to be reprocessed","");jQuery("li.shortpixel-toolbar-processing").removeClass("shortpixel-hide");jQuery("li.shortpixel-toolbar-processing").addClass("shortpixel-processing");var t={action:"shortpixel_redo",attachment_ID:e,type:r};jQuery.get(ShortPixel.AJAX_URL,t,(function(r){t=JSON.parse(r);if(t["Status"]==ShortPixel.STATUS_SUCCESS){setBulkTimer(2e3);ShortPixel.BULK_SECRET=false}else{$msg=typeof t["Message"]!=="undefined"?t["Message"]:_spTr.thisContentNotProcessable;setCellMessage(e,$msg,"");showToolBarAlert(ShortPixel.STATUS_FAIL,$msg)}}))}function optimizeThumbs(e){setCellMessage(e,"<img src='"+ShortPixel.WP_PLUGIN_URL+"/res/img/loading.gif' alt='"+_spTr.loading+"' class='sp-loading-small'>"+_spTr.imageWaitOptThumbs,"");jQuery("li.shortpixel-toolbar-processing").removeClass("shortpixel-hide");jQuery("li.shortpixel-toolbar-processing").addClass("shortpixel-processing");var r={action:"shortpixel_optimize_thumbs",attachment_ID:e};jQuery.get(ShortPixel.AJAX_URL,r,(function(t){r=JSON.parse(t);if(r["Status"]==ShortPixel.STATUS_SUCCESS){setBulkTimer(2e3);ShortPixel.BULK_SECRET=false}else{setCellMessage(e,typeof r["Message"]!=="undefined"?r["Message"]:_spTr.thisContentNotProcessable,"")}}))}function dismissShortPixelNotice(e){jQuery("#short-pixel-notice-"+e).hide();var r={action:"shortpixel_dismiss_notice",notice_id:e};jQuery.get(ShortPixel.AJAX_URL,r,(function(e){r=JSON.parse(e);if(r["Status"]==ShortPixel.STATUS_SUCCESS){console.log("dismissed")}}))}function dismissFileError(){jQuery(".shortpixel-alert").hide();var e={action:"shortpixel_dismissFileError"};jQuery.get(ShortPixel.AJAX_URL,e,(function(r){e=JSON.parse(r);if(e["Status"]==ShortPixel.STATUS_SUCCESS){console.log("dismissed")}}))}function PercentageAnimator(e,r){this.animationSpeed=10;this.increment=2;this.curPercentage=0;this.targetPercentage=r;this.outputSelector=e;this.animate=function(e){this.targetPercentage=e;setTimeout(PercentageTimer.bind(null,this),this.animationSpeed)}}function PercentageTimer(e){if(e.curPercentage-e.targetPercentage<-e.increment){e.curPercentage+=e.increment}else if(e.curPercentage-e.targetPercentage>e.increment){e.curPercentage-=e.increment}else{e.curPercentage=e.targetPercentage}jQuery(e.outputSelector).text(e.curPercentage+"%");if(e.curPercentage!=e.targetPercentage){setTimeout(PercentageTimer.bind(null,e),e.animationSpeed)}}function progressUpdate(e,r){var t=jQuery("#bulk-progress");if(t.length){jQuery(".progress-left",t).css("width",e+"%");jQuery(".progress-img",t).css("left",e+"%");if(e>24){jQuery(".progress-img span",t).html("");jQuery(".progress-left",t).html(e+"%")}else{jQuery(".progress-img span",t).html(e+"%");jQuery(".progress-left",t).html("")}jQuery(".bulk-estimate").html(r)}}function sliderUpdate(e,r,t,i,s){var o=jQuery(".bulk-slider div.bulk-slide:first-child");if(o.length===0){return}if(o.attr("id")!="empty-slide"){o.hide()}o.css("z-index",1e3);jQuery(".bulk-img-opt",o).attr("src","");if(typeof t==="undefined"){t=""}if(t.length>0){jQuery(".bulk-img-orig",o).attr("src","")}var a=o.clone();a.attr("id","slide-"+e);jQuery(".bulk-img-opt",a).attr("src",r);if(t.length>0){jQuery(".img-original",a).css("display","inline-block");jQuery(".bulk-img-orig",a).attr("src",t)}else{jQuery(".img-original",a).css("display","none")}jQuery(".bulk-opt-percent",a).html('<input type="text" class="dial" value="'+i+'"/>');jQuery(".bulk-slider").append(a);ShortPixel.percentDial("#"+a.attr("id")+" .dial",100);jQuery(".bulk-slider-container span.filename").html("&nbsp;&nbsp;"+s);if(o.attr("id")=="empty-slide"){o.remove();jQuery(".bulk-slider-container").css("display","block")}else{o.animate({left:o.width()+o.position().left},"slow","swing",(function(){o.remove();a.fadeIn("slow")}))}}function hideSlider(){jQuery(".bulk-slider-container").css("display","none")}function showStats(){var e=jQuery(".bulk-stats");if(e.length>0){}}function SPstringFormat(){var e=Array.prototype.slice.call(arguments);if(e.length===0)return;var r=e.shift();for(i=0;i<e.length;i++){r=r.replace(new RegExp("\\{"+i+"\\}","gm"),e[i])}return r}(function(e,r,t){r.SpioResize={image:{width:0,height:0},lag:2e3,step1:false,step2:false,step3:false,sizeRule:null,initialized:false,lastW:false,lastH:false,lastType:false};SpioResize.hide=function(){e(".presentation-wrap").css("opacity",0)};SpioResize.animate=function(e,r,t,i,s){e.animate(r,1e3,"swing",(function(){SpioResize.step3=setTimeout((function(){document.styleSheets[0].deleteRule(SpioResize.sizeRule);t.animate(i,1e3,"swing",(function(){SpioResize.sizeRule=document.styleSheets[0].insertRule(s)}))}),600)}))};SpioResize.run=function(){if(!SpioResize.initialized){var r=e(t);r.on("input change",'input[name="resizeWidth"], input[name="resizeHeight"]',(function(e){clearTimeout(SpioResize.change);SpioResize.changeDone=true;SpioResize.changeFired=false;SpioResize.change=setTimeout((function(){SpioResize.changeFired=true;SpioResize.run()}),1500)}));r.on("blur",'input[name="resizeWidth"], input[name="resizeHeight"]',(function(e){if(SpioResize.changeFired){return}clearTimeout(SpioResize.change);SpioResize.change=setTimeout((function(){SpioResize.run()}),1500)}));r.on("change",'input[name="resizeType"]',(function(e){SpioResize.run()}));SpioResize.initialized=true}var i=e("#width").val();var s=e("#height").val();if(!i||!s)return;var o=e("#resize_type_outer").is(":checked")?"outer":"inner";if(i===SpioResize.lastW&&s===SpioResize.lastH&&o===SpioResize.lastType){return}SpioResize.hide();SpioResize.lastW=i;SpioResize.lastH=s;SpioResize.lastType=o;var a=Math.round(120*Math.sqrt(i/s));var l=Math.round(120*Math.sqrt(s/i));var n=a/l;if(a>280){a=280;l=Math.round(280/n)}if(l>150){l=150;a=Math.round(150*n)}var u=15/8;var p=e("img.spai-resize-img");p.css("width","");p.css("height","");p.css("margin","0px");var c=e("div.spai-resize-frame");c.css("display","none");c.css("width",a+"px");c.css("height",l+"px");c.css("margin",Math.round((156-l)/2)+"px auto 0");clearTimeout(SpioResize.step1);clearTimeout(SpioResize.step2);clearTimeout(SpioResize.step3);p.stop();c.stop();if(SpioResize.sizeRule!==null){document.styleSheets[0].deleteRule(SpioResize.sizeRule);SpioResize.sizeRule=null}SpioResize.sizeRule=document.styleSheets[0].insertRule('.spai-resize-frame:after { content: "'+i+" × "+s+'"; }');c.addClass("spai-resize-frame");e(".presentation-wrap").animate({opacity:1},500,"swing",(function(){c.css("display","block");SpioResize.step2=setTimeout((function(){if(o=="outer"){if(u>n){var e={height:l+"px",margin:Math.round((160-l)/2)+"px 0px"};var r=l*u;var t={width:Math.round(r)+"px"};var d='.spai-resize-frame:after { content: "'+Math.round(r*i/a)+" × "+s+'"; }'}else{var e={width:a+"px",margin:Math.round((160-a/u)/2)+"px 0px"};var h=a/u;var t={height:Math.round(h)+"px",margin:Math.round((156-h)/2)+"px auto 0"};var d='.spai-resize-frame:after { content: "'+i+" × "+Math.round(h*i/a)+'"; }'}}else{if(u>n){var e={width:a,margin:Math.round((160-a/u)/2)+"px 0px"};var h=a/u;var t={height:Math.round(h)+"px",margin:Math.round((156-h)/2)+"px auto 0"};var d='.spai-resize-frame:after { content: "'+i+" × "+Math.round(h*i/a)+'"; }'}else{var e={height:l,margin:Math.round((160-l)/2)+"px 0px"};var r=l*u;var t={width:Math.round(r)+"px"};var d='.spai-resize-frame:after { content: "'+Math.round(r*i/a)+" × "+s+'"; }'}}SpioResize.animate(p,e,c,t,d)}),1e3)}))};e((function(){if(e("#resize").is("checked")){SpioResize.run()}}))})(jQuery,window,document);